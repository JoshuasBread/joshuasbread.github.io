<!DOCTYPE HTML>
<html>

<head>
    <title>Joshua's Bread</title>
    <link rel="icon" type="image/x-icon" href="favicon.png">
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>
    <link rel="stylesheet" href="assets/css/main.css"/>
    <noscript>
        <link rel="stylesheet" href="assets/css/noscript.css"/>
    </noscript>
</head>

<body class="is-preload">
<!-- Wrapper -->
<div id="wrapper">
    <!-- Header -->
    <header id="header" class="alt">
        <span class="logo"><img src="images/logo.svg" alt="Logo" style="max-width:250px;width:100%"/></span>
        <h1>Joshua's Bread</h1>
        <p>The dough is rising...<br/>Very nice</p>
    </header>
    <!-- Main -->
    <div id="main" style="max-width:1200px;">
        <section id="first" class='main'>
            <div class="table-wrapper">
                <header class="major">
                    <h2>Available breads</h2>
                    <p>Straight from the Lord's mouth into your own</p>
                </header>
                <table>
                    <tbody id="items-table-body">
                    </tbody>
                    <tfoot id="items-table-foot">
                    <tr>
                        <td style="text-align: right;">
                            <h2>Cart</h2>
                        </td>
                    </tr>
                    <tr>

                        <td style="text-align: right;">
                            <span id="selected-items-count"></span>
                        </td>

                        <td>
                            <span id="selected-items-name"></span>
                        </td>

                        <td id="selected-items-price">
                        </td>

                    </tr>
                    <tr style="font-weight: bold">
                        <td colspan="1"></td>
                        <td style="text-align: right;">Total</td>
                        <td id="selected-items-total-price">
                            $0.00
                        </td>
                    </tr>
                    </tfoot>
                </table>


                <section>
                    <h2>Checkout</h2>
                    <form method="post" onsubmit="updateBreadLedger(); return false;">
                        <div class="row gtr-uniform">
                            <div class="col-6 col-12-xsmall">
                                <label for="customer-name">Full name:</label>
                                <input type="text" name="customer-name"
                                       id="customer-name"
                                       value="" placeholder="Your Name" required/>
                            </div>
                            <div class="col-6 col-12-xsmall">
                                <label for="customer-email">Email:</label>
                                <input type="email" name="customer-email"
                                       id="customer-email"
                                       value="" required/>
                            </div>
                            <div class="col-6 col-12-xsmall">
                                <label for="payment-method">Payment method:</label>
                                <select name="payment-method"
                                        id="payment-method" required>
                                    <option disabled selected value></option>
                                    <option value="Cash">Cash</option>
                                    <option value="Venmo">Venmo</option>
                                    <option value="Zelle">Zelle</option>
                                    <option value="Paypal">Paypal</option>
                                </select>
                            </div>
                            <div class="col-6 col-12-xsmall">
                                <label for="pickup-time">Pickup time:</label>
                                <select name="pickup-time" id="pickup-time" required>
                                    <option disabled selected value></option>
                                    <option value="1">Manufacturing</option>
                                    <option value="1">Shipping</option>
                                    <option value="1">Administration</option>
                                    <option value="1">Human Resources</option>
                                </select>
                            </div>
                            <div class="col-12" style="text-align: center">
                                <input type="checkbox" id="read-instructions" name="read-instructions" required>
                                <label for="read-instructions">I've read the instructions</label>
                            </div>
                            <div class="col-12">
                                <ul class="actions" style="justify-content: center">
                                    <li><input type="submit" value="Submit"/></li>
                                </ul>
                            </div>
                        </div>
                    </form>
                </section>

            </div>
        </section>

    </div>
    <!-- Footer -->
    <footer id="footer">
        <section>
            <h2>Aliquam sed mauris</h2>
            <p>Sed lorem ipsum dolor sit amet et nullam consequat feugiat consequat magna adipiscing tempus etiam dolore
                veroeros. eget dapibus mauris. Cras aliquet, nisl ut viverra sollicitudin, ligula erat egestas velit,
                vitae tincidunt odio.
            </p>
        </section>
        <section>
            <h2>Etiam feugiat</h2>
            <dl class="alt">
                <dt>Address</dt>
                <dd>1234 Somewhere Road &bull; Nashville, TN 00000 &bull; USA</dd>
                <dt>Phone</dt>
                <dd>(000) 000-0000 x 0000</dd>
                <dt>Email</dt>
                <dd><a href="#">information@untitled.tld</a></dd>
            </dl>
        </section>
    </footer>
</div>
<!-- Scripts -->
<script src="assets/js/default/js/jquery.min.js"></script>
<script src="assets/js/default/js/jquery.scrollex.min.js"></script>
<script src="assets/js/default/js/jquery.scrolly.min.js"></script>
<script src="assets/js/default/js/browser.min.js"></script>
<script src="assets/js/default/js/breakpoints.min.js"></script>
<script src="assets/js/default/js/util.js"></script>
<script src="assets/js/default/js/main.js"></script>
<script src="assets/js/sheetsAPI.js"></script>
<script src="assets/js/utils.js"></script>
<script>
    let domIds = [];

    async function init() {
        const breadLedgerData = await getBreadLedgerData();

        // Map item names to DOM ids
        const itemNames = breadLedgerData.map(data => data.name);
        domIds = itemNamesToDOMIds(itemNames);

        // Insert rows into table
        for (const breadData of breadLedgerData) {
            const countOptionsHtml = [...Array(breadData.quantity + 1).keys()]
                .map(i => `<option value="${i}">${i}</option>`)
                .join('');

            const rowHtml = `
                <tr>
                    <td>
                        <span class="image">
                            <img class="thumbnail" src="${breadData.image}" alt="" style="max-width:150px;width:100%"/>
                        </span>
                    </td>
                    <td>
                        <strong id="${breadData.name}-name">${breadData.name}</strong>
                        <br>
                        <em>${breadData.description}</em>
                    </td>
                    <td>
                        <p id="${breadData.name}-price" style="text-align:center">$${parseFloat(breadData.cost).toFixed(2)}</p>
                        <select name="${breadData.name}-count" id="${breadData.name}-count" class="select-count" onchange="updateCart()">
                            ${countOptionsHtml}
                        </select>
                    </td>
                </tr>
            `;

            document.getElementById('items-table-body').insertAdjacentHTML('beforeend', rowHtml);
        }
    }

    function updateCart() {
        // Initialize variables
        let itemNames = "";
        let itemCounts = "";
        let itemPrices = "";
        let totalItemPrices = 0;

        // Loop through all selected items
        for (const domId of domIds) {
            const {name: nameId, count: countId, price: priceId} = domId;
            const itemCount = parseInt(document.getElementById(countId).value);

            // Skip items with count 0
            if (!itemCount) {
                continue;
            }

            // Get item name and price
            const itemName = document.getElementById(nameId).innerText;
            const itemPrice = parseFloat(document.getElementById(priceId).innerText.split('$')[1]);

            // Update strings and total item prices
            itemNames += `${itemName}<br>`;
            itemCounts += `x${itemCount}<br>`;
            itemPrices += `$${itemPrice * itemCount}<br>`;
            totalItemPrices += itemPrice * itemCount;
        }

        // Update HTML elements with selected item information and total price
        document.getElementById("selected-items-name").innerHTML = itemNames;
        document.getElementById("selected-items-count").innerHTML = itemCounts;
        document.getElementById("selected-items-price").innerHTML = itemPrices;
        document.getElementById("selected-items-total-price").innerText = `$${totalItemPrices.toFixed(2)}`;
    }

    function updateBreadLedger() {
        const customerName = document.getElementById('customer-name').value;
        const email = document.getElementById('customer-email').value;
        const paymentMethod = document.getElementById('payment-method').value
        const pickupTime = document.getElementById('pickup-time').value;


        const customerData = {
            customerName,
            pickupTime: "5:00pm",
            paymentMethod,
            email,
        };

        writeBreadLedgerData(customerData, {Baguette: "3", Focaccia: "4"}, `$5.00`);
    }

    // Initialize the page
    init();
</script>

</body>

</html>